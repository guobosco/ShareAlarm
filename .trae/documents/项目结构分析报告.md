# ShareAlarm 项目文件结构与功能分析

## 根目录结构

| 文件夹/文件 | 作用 |
|------------|------|
| `.trae/` | Trae IDE 相关文件，包含项目开发计划文档 |
| `app/` | 主要应用源码目录，包含所有核心代码 |
| `gradle/` | Gradle 构建工具相关文件 |
| `.gitignore` | Git 忽略规则文件，指定不需要版本控制的文件 |
| `LICENSE` | 项目许可证文件，MIT 许可证 |
| `README.md` | 项目说明文档，包含功能介绍、技术栈、架构设计等 |
| `build.gradle.kts` | 项目级构建配置文件，定义项目依赖和插件 |
| `code_structure_diagram.md` | 代码结构和逻辑关系分析文档，包含 Mermaid 图表 |
| `gradle.properties` | Gradle 配置属性文件 |
| `gradlew`/`gradlew.bat` | Gradle 包装器脚本，用于在不同环境中运行 Gradle 命令 |
| `settings.gradle.kts` | Gradle 设置文件，定义项目模块 |

## 1. `.trae/` 目录

| 文件夹/文件 | 作用 |
|------------|------|
| `documents/` | 存放项目相关文档 |
| `共享闹钟安卓App开发计划.md` | 项目开发计划文档，包含需求分析、功能规划、开发进度等 |

## 2. `app/` 目录

### 2.1 `app/build.gradle.kts`
应用级构建配置文件，定义应用的依赖、编译选项、构建类型等。

### 2.2 `app/src/main/` 目录
应用主源码目录，包含 Java/Kotlin 代码、资源文件和 Android 配置文件。

#### 2.2.1 `app/src/main/java/com/example/sharealarm/` 目录
Java/Kotlin 源码主目录，按照 MVVM 架构组织。

##### 2.2.1.1 `data/` 目录 - 数据层

| 文件夹/文件 | 作用 |
|------------|------|
| `local/` | 本地数据库相关文件 |
| `AlarmDatabase.kt` | Room 数据库定义，包含表结构和 DAO 接口 |
| `AlarmDatabaseInstance.kt` | 数据库实例管理，提供单例访问 |
| `model/` | 数据模型类 |
| `Organization.kt` | 组织数据模型 |
| `Reminder.kt` | 提醒数据模型 |
| `User.kt` | 用户数据模型 |
| `remote/` | 远程服务相关文件 |
| `CloudbaseAuthService.kt` | Cloudbase 认证服务实现 |
| `CloudbaseDatabaseService.kt` | Cloudbase 数据库服务实现 |
| `CloudbaseInitializer.kt` | Cloudbase 初始化配置 |
| `repository/` | 数据仓库层，协调本地和远程数据源 |
| `AuthRepository.kt` | 认证数据仓库，处理用户登录注册 |
| `OrganizationRepository.kt` | 组织数据仓库，处理组织相关操作 |
| `ReminderRepository.kt` | 提醒数据仓库，处理提醒相关操作 |
| `viewmodel/` | ViewModel 层，管理 UI 状态和业务逻辑 |
| `AuthViewModel.kt` | 认证 ViewModel，管理登录注册状态 |
| `OrganizationViewModel.kt` | 组织 ViewModel，管理组织列表和操作 |
| `ReminderViewModel.kt` | 提醒 ViewModel，管理提醒列表和操作 |

##### 2.2.1.2 `service/` 目录 - 服务层

| 文件夹/文件 | 作用 |
|------------|------|
| `AlarmReceiver.kt` | 闹钟广播接收器，接收系统闹钟触发事件 |
| `AlarmService.kt` | 闹钟服务，处理闹钟触发逻辑 |
| `CloudbaseMessagingService.kt` | Cloudbase 消息推送服务 |
| `NotificationService.kt` | 通知服务，负责显示系统通知 |

##### 2.2.1.3 `ui/` 目录 - UI 层

| 文件夹/文件 | 作用 |
|------------|------|
| `navigation/` | 导航相关文件 |
| `NavHost.kt` | 导航主机，定义应用导航结构 |
| `screen/` | 应用屏幕组件 |
| `CreateOrganizationScreen.kt` | 创建组织页面 |
| `CreateReminderScreen.kt` | 创建提醒页面 |
| `HomeScreen.kt` | 首页，显示提醒和组织列表 |
| `JoinOrganizationScreen.kt` | 加入组织页面 |
| `SignInScreen.kt` | 登录页面 |
| `SignUpScreen.kt` | 注册页面 |
| `theme/` | 应用主题相关文件 |
| `Color.kt` | 颜色定义 |
| `ShareAlarmTheme.kt` | 主题配置 |
| `Type.kt` | 字体样式定义 |
| `MainActivity.kt` | 应用主活动，启动应用并加载 Compose UI |

##### 2.2.1.4 `ShareAlarmApplication.kt`
应用自定义 Application 类，负责初始化应用级组件。

#### 2.2.2 `app/src/main/res/` 目录 - 资源文件

| 文件夹/文件 | 作用 |
|------------|------|
| `values/` | 资源值文件 |
| `colors.xml` | 颜色资源定义 |
| `strings.xml` | 字符串资源定义 |
| `themes.xml` | 主题资源定义 |

#### 2.2.3 `app/src/main/AndroidManifest.xml`
Android 应用清单文件，定义应用权限、组件、主题等配置。

## 3. `gradle/` 目录

| 文件夹/文件 | 作用 |
|------------|------|
| `wrapper/` | Gradle 包装器相关文件 |
| `gradle-wrapper.jar` | Gradle 包装器 Jar 文件 |
| `gradle-wrapper.properties` | Gradle 包装器配置文件，指定 Gradle 版本和下载地址 |

## 核心功能模块分析

### 1. 用户认证模块
**功能**：处理用户注册、登录和身份验证
**主要文件**：
- `SignInScreen.kt` / `SignUpScreen.kt`：登录注册页面
- `AuthViewModel.kt`：管理认证状态和业务逻辑
- `AuthRepository.kt`：封装认证数据访问逻辑
- `CloudbaseAuthService.kt`：Cloudbase 认证服务实现

### 2. 组织管理模块
**功能**：管理用户组织，支持创建、加入和退出组织
**主要文件**：
- `CreateOrganizationScreen.kt`：创建组织页面
- `JoinOrganizationScreen.kt`：加入组织页面
- `OrganizationViewModel.kt`：管理组织状态和业务逻辑
- `OrganizationRepository.kt`：封装组织数据访问逻辑

### 3. 提醒管理模块
**功能**：管理共享提醒，支持创建、编辑和删除提醒
**主要文件**：
- `CreateReminderScreen.kt`：创建提醒页面
- `HomeScreen.kt`：显示提醒列表
- `ReminderViewModel.kt`：管理提醒状态和业务逻辑
- `ReminderRepository.kt`：封装提醒数据访问逻辑
- `AlarmDatabase.kt`：本地 Room 数据库

### 4. 闹钟服务模块
**功能**：处理闹钟触发和通知
**主要文件**：
- `AlarmReceiver.kt`：接收系统闹钟触发事件
- `AlarmService.kt`：处理闹钟触发逻辑
- `NotificationService.kt`：显示系统通知

## 技术栈与架构

| 技术/架构 | 用途 |
|---------|------|
| Kotlin | 主要开发语言 |
| Jetpack Compose | 现代化 UI 框架 |
| MVVM 架构 | 清晰的分层设计，分离 UI 和业务逻辑 |
| Room | 本地数据库 |
| Cloudbase | 云端服务，提供认证、数据库和推送服务 |
| Navigation Compose | 页面导航管理 |
| ViewModel | 状态管理 |
| WorkManager | 后台任务管理 |

## 数据流向

1. **UI 层**：用户与 Compose 界面交互
2. **ViewModel 层**：处理业务逻辑，管理 UI 状态
3. **Repository 层**：协调本地数据库和云端服务
4. **数据层**：
   - 本地：Room 数据库存储数据
   - 远程：Cloudbase 云端服务同步数据
5. **服务层**：处理后台任务，如闹钟触发和通知

## 核心流程

### 1. 用户登录流程
```
用户 -> SignInScreen -> AuthViewModel -> AuthRepository -> CloudbaseAuthService -> Cloudbase SDK
```

### 2. 创建提醒流程
```
用户 -> CreateReminderScreen -> ReminderViewModel -> ReminderRepository -> 
  (CloudbaseDatabaseService + AlarmDatabase) -> 设置系统闹钟 -> 显示通知
```

### 3. 闹钟触发流程
```
系统时间到达 -> AlarmManager -> AlarmReceiver -> AlarmService -> NotificationService -> 显示通知
```

## 应用权限

| 权限 | 用途 |
|------|------|
| `INTERNET` | 网络访问 |
| `VIBRATE` | 振动提醒 |
| `RECEIVE_BOOT_COMPLETED` | 设备重启后重设闹钟 |
| `SCHEDULE_EXACT_ALARM` | 精确闹钟调度 |
| `POST_NOTIFICATIONS` | 发送通知 |

## 总结

ShareAlarm 是一个基于 Kotlin 和 Jetpack Compose 开发的共享闹钟应用，采用 MVVM 架构模式，结合本地 Room 数据库和 Cloudbase 云端服务，实现了用户认证、组织管理和共享提醒等核心功能。项目结构清晰，模块化设计，便于维护和扩展。应用支持系统闹钟和推送通知，确保用户不会错过重要提醒。